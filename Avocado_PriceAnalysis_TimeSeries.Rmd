---
title: "MTH783P Final Project"
author: "Nigam Pranav, 230138438, ah23479@qmul.ac.uk"
date: 'Last compiled on: ''28 04 2024''`'
output: pdf_document
header-includes: \usepackage[T1]{fontenc} \usepackage[utf8]{inputenc} \usepackage{lmodern}
  \usepackage{lipsum} \usepackage{fancyhdr} \pagestyle{fancy} \renewcommand{\headrulewidth}{0pt}
  \fancyhf{} \fancyfoot[C]{\twopagenumbers} \fancypagestyle{plain}{ \renewcommand{\headrulewidth}{0pt}
  \fancyhf{} \fancyfoot[C]{\twopagenumbers} \stepcounter{pageaux} \thepageaux\, of\,
  \ref{\currentauxref} \clearpage \edef\@currentlabel{\thepageaux}\label{\currentauxref}
  \xdef\currentauxref{PAGEAUX\thepage} \setcounter{pageaux}{0}}
abstract: This project explores time series analysis of avocado prices in the United States from 2015 to 2018. The dataset includes weekly average prices, total volume sold, and other variables across various cities. Through exploratory data analysis, including visualizations and statistical summaries, key patterns such as seasonal trends, price distributions, and outlier detection were identified. Additionally, the project involves splitting the data into training and test sets for forecasting purposes. The findings provide insights into avocado market dynamics.'
---


<!--
#########################################################
###         DO NOT CHANGE the following code          ###
#########################################################
-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

\thispagestyle{empty}
\newpage
\setcounter{page}{1}

<!--
#########################################################
###      Start writing your report from line 61       ###
#########################################################
-->

# R markdown
Q1.A) I split the dataset into train and test model, where, I splitted them on the basis of region.

Q1.B) Producing Exploratory Plots

This is a time series plot for average price of avocados over time,  
Possible outliers: In the year 2017 and 2018, we can see some spikes, where there is some significant change in the average price. These are possible outliers where we could indicate time periods when the average price was slightly higher than usual. 
Trend: We can see some seasonality, as the prices are peaking roughly around the same time every year. In terms of trend, there is a slightly upward trend especially when looking at the levels from 2015 to 2017. 

This is the boxplot for the average price based on type of avocado, 
In terms of distribution for price, we can observe that Organic avocados are priced higher compared to Conventional. 
Possible Outliers: Organic avocados have outliers on both ends, from which we can conclude that there was a variation in prices of avocado. 

This is the scatterplot showing the relationship between the Average Price and total volume of avocados, 
Possible Outliers: As we can observe, there are some points which are isolated from the main cluster. These are possible outliers. We can conclude that there were weeks where avocados were sold in large quantities at significantly lower prices, due to special sales. 
We can observe that there is a slight trend where higher volumes correlate to a slight decrease in average price, which indicates a bulk discount effect. 

Q1.C) I have decided to go for ARIMA as my statistical model.
c.1)The reason I chose to use an ARIMA model is because of few reasons:
ARIMA model has characteristics that helps in making us understand few processes (for eg. the autoregressive function helps in identifying how future values are affected by past values).
ARIMA has automatic functions like 'auto.arima()' which makes it convinient to get a fitting model without any need of specifying the ARIMA model order.
Also, ARIMA would be appropriate for data which can be transformed stationary through differencing.

c.2) Other model that I tried was:
Seasonal decomposition of time series
In this model, I decomposed the data into seasosnal, trend, and residual component.
This method can be combined with other statistical models (such as ARIMA) for de-seasonalizing the data.
But, this model can cause some over-fitting modelling issues.

GARCH model
This model requires more complex understandig of the data's volatility strucuture.
ARIMA is a better fit model when used for predicting future values from the past values.


c.3) #The underlying assumptions of the ARIMA model are:
Stationary: It is the most fundamental assumption, means basically the statistical properties (mean, variance, etc) are constant over time, and the time series can be made stationary by differencing them.
Autocorrelation: ARIMA model assumes that through AR(Autoregressve) and MA(moving average) functions, the autocorrelations in the data can be attained, where the AR part involve regressing teh variables, and MA part involve specifying errors of the series.

c.4)Few weaknesses of ARIMA model are:
0utliers: ARIMA models are sensitive to  outliers.
Long-term forecast: ARIMA models are better for short-term forecasting, in long-term it can lead to less precise decisions.
ARIMA models assume the model to be stationary after differencing.
ARIMA models do not account for seasonality, SARIMA is a better model in that case.




This is an R Markdown document, for more details on using R Markdown see <http://rmarkdown.rstudio.com>.
When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

**NOTE:** differently from R, comments in Rmarkdown must be included between `<!--` and `-->`.

\bigskip  <!-- put extra vertical space:  \bigskip, \medskip, \smallskip -->


<!--
#########################################################
### DO NOT CHANGE the code until the section 'R code' ###
#########################################################
-->


\newpage
\thispagestyle{empty}
\begin{center}
\Huge \bf [END of the REPORT]
\end{center}


\resetpageaux
\renewcommand{\thepageaux}{R-\arabic{pageaux}}



# R code
```{r}
#loading the necessary libraries
library(fma)
library(fpp)
library(ggplot2)
library(forecast)
library(zoo)
library(tseries)
library(dplyr)
#loading the dataset
avocado_data <- read.csv("~/Desktop/TimeSeries Analysis for Business Project/avocado.csv")
avocado_data$Date <- as.Date(avocado_data$Date)
city_data <- avocado_data %>%
  filter(region == "Detroit")
city_data_total <- city_data %>%
  group_by(Date) %>%
  summarise(AveragePrice = weighted.mean(AveragePrice, Total.Volume),
            Total.Volume= sum(Total.Volume))
#mean imputation for filling NA Values
any(is.na(city_data_total))
mean_price_data <- mean(city_data_total$AveragePrice, na.rm = TRUE)
avocado_data_assigned <- city_data_total
avocado_data_assigned$AveragePrice[is.na(city_data_total$AveragePrice)] <- mean_price_data
#I am converting the 'Date' Column to Date Format
avocado_data$Date <- as.Date(avocado_data$Date, format = "%Y-%m-%d")
```

```{r}
train_data <- avocado_data_assigned[avocado_data_assigned$Date <= "2017-12-31", ]
test_data <- avocado_data_assigned[avocado_data_assigned$Date >= "2018-01-01" & avocado_data_assigned$Date <= "2018-03-11", ]
# Summary statistics
summary(train_data)
```

```{r}
#b) Producing Exploratory plots

#Plotting TimeSeries for Average Price:
ggplot(train_data, aes(x = Date, y = AveragePrice)) +
  geom_line() +
  labs(title = "Avocados Average Price over time",
       x = "Date",
       y = "Average Price of Avocado")

#Some key findings:
#Here, we can observe a seasonal pattern within each year, where the average price changes regularly. This indicates that the average price of avocados could be affected by factors with a seasonal cycle, like weather conditions.
# We can observe some particularly sharp peaks, which could be outliers and we can indicate that's where the average price was quite high.


#Plotting boxplot for Price by type
ggplot(avocado_data, aes(x = type, y = AveragePrice)) +
  geom_boxplot() +
  labs(title = "Average Price distribution by Type of Avocado",
       x = "Type",
       y = "Average Price")

ggplot(train_data, aes(x = Total.Volume, y = AveragePrice)) +
  geom_point(alpha = 0.8) +
  labs(title = "Average Price and Total Volume Relationshio",
       x = "Total Volume",
       y = "Average Price") 

#Some key findings are:
#In terms of distribution for price, We can see that Organic observations avocados are priced higher when compared to conventional, as seen by the position of the box.
#Outliers:
#Organic avocados have outliers on both the ends, which indicates that there are weeks when there was a variation in prices of avocado.
#In case of conventional, there are few outliers, on the lower part, which indicates a lower price during that period.
#In terms of variable distribution, conventional are more around the median, which indicates that there is an even share of prices.
#In Organic, the median seems to be closer to the bottom of the box.

#generating summary statistics for training dataset
summary(train_data)
```

```{r}
#c) Fitting an appropriate statistical model to the training data
# I am using ARIMA as my statistical model
#The first date in my training data is '2015-01-04' in weekly intervals

avg_unitprice_ts <- ts(train_data$AveragePrice, frequency = 40, start = c(2015,1))
#fitting the ARIMA model
fit_arima <- auto.arima(avg_unitprice_ts)
summary(fit_arima)


#The reason I chose to use an ARIMA model is because of few reasons:
# ARIMA model has characteristics that helps in making us understand few processes (for eg. the autoregressive function helps in identifying how future values are affected by past values).
# ARIMA has automatic functions like 'auto.arima()' which makes it convinient to get a fitting model without any need of specifying the ARIMA model order.
# Also, ARIMA would be appropriate for data which can be transformed stationary through differencing.

#Other model that I tried was:
#Seasonal decomposition of time series
# In this model, I decomposed the data into seasosnal, trend, and residual component.
# This method can be combined with other statistical models (such as ARIMA) for de-seasonalizing the data.
# But, I found ARIMA to be the better fitting model.

#The underlying assumptions of the ARIMA model are:
#Stationary: It is the most fundamental assumption, means basically the statistical properties (mean, variance, etc) are constant over time, and the time series can be made stationary by differencing them.
# Autocorrelation: ARIMA model assumes that through AR(Autoregressve) and MA(moving average) functions, the autocorrelations in the data can be attained, where the AR part involve regressing teh variables, and MA part involve specifying errors of the series.

res <- residuals(fit_arima)
plot(res, main = "Residuals_ARIMA", ylab = "Residual")
plot(acf(res))
plot(pacf(res))

Box.test(res, type="Ljung-Box")


#Forecasting the average unit price of avocado
arima_model <- auto.arima(avg_unitprice_ts)
avocado_forecast_value <- forecast(arima_model, h=10)
#plot(avocado_forecast_value)
print(avocado_forecast_value)
plot(avocado_forecast_value)


#Few weaknesses of ARIMA model are:
# 0utliers: ARIMA models are sensitive to  outliers.
#Long-term forecast: ARIMA models are better for short-term forecasting, in long-term it can lead to less precise decisions.
# ARIMA models assume the model to be stationary after differencing.
# ARIMA models do not account for seasonality, SARIMA is a better model in that case.
```